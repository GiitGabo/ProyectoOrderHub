<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="~/css/AdminPagos.css" />

@model IEnumerable<JarredsOrderHub.Models.Pedido> 


<div class="container mt-4">
    <h2 class="mb-4">@ViewBag.Title</h2>

    <table class="table table-striped">
        <thead>
            <tr>
                <th>Pedido ID</th>
                <th>Fecha</th>
                <th>Estado</th>
                <th>Método de Pago</th>
                <th>Total</th>
                <th>Horario</th>
                <th>Acciones</th>
            </tr>
        </thead>
        <tbody>
            @foreach (var pedido in Model)
            {
                <tr>
                    <td>@pedido.Id</td>
                    <td>@pedido.FechaPedido.ToString("dd/MM/yyyy HH:mm")</td>
                    <td>@pedido.EstadoPedido</td>
                    <td>@(pedido.Pago != null ? pedido.Pago.MetodoPago : "N/A")</td>
                    <td>@pedido.Total.ToString("C")</td>
                    <td>@(pedido.Horario != null ? pedido.Horario.HoraInicio.ToString("HH:mm") : "Sin Horario")</td>
                    <td>
                        <!-- Puedes agregar un enlace para ver detalles o editar el pedido -->
                        <a href="@Url.Action("DetallesPedido", "Pago", new { id = pedido.Id })" class="btn btn-info btn-sm">
                            Detalles
                        </a>
                    </td>
                </tr>
            }
        </tbody>
    </table>
</div>


<!-- Modal de Detalles del Pedido -->
<div id="modalDetalles" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="modalTitle">Detalles del Pedido</h2>
            <span class="close" onclick="cerrarModal()">&times;</span>
        </div>

        <p id="detallesPedido"></p>
    </div>
</div>

<!-- Modal para reenviar factura -->
<div id="modalReenviarFactura" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>Reenviar Factura</h2>
            <span class="close" onclick="cerrarModal()">&times;</span>
        </div>
        
        <p id="reenviarMensaje"></p>
        <button onclick="reenviarFacturaConfirmado()">Enviar Factura</button>
    </div>
</div>

<script>
    // Función para ver detalles del pedido
    function verDetalles(pedidoId) {
        // Simular la carga de los detalles del pedido
        let detalles = `Detalles del pedido #${pedidoId}:
                    - Pizza Margarita
                    - Rice and Beans
                    Total: $12.00`;

        // Mostrar el contenido en el modal
        document.getElementById("detallesPedido").innerText = detalles;

        // Mostrar el modal
        document.getElementById("modalDetalles").style.display = "block";
    }

    // Función para reenviar la factura
    function reenviarFactura(pedidoId) {
        // Simular la acción de reenviar factura
        let mensaje = `¿Deseas reenviar la factura del pedido #${pedidoId}?`;

        // Mostrar el mensaje en el modal
        document.getElementById("reenviarMensaje").innerText = mensaje;

        // Mostrar el modal
        document.getElementById("modalReenviarFactura").style.display = "block";
    }

    // Función para confirmar el envío de la factura
    function reenviarFacturaConfirmado() {
        alert("Factura reenviada exitosamente!");
        cerrarModal();
    }

    // Función para cerrar el modal
    function cerrarModal() {
        document.getElementById("modalDetalles").style.display = "none";
        document.getElementById("modalReenviarFactura").style.display = "none";
    }

    // Cerrar el modal si se hace clic fuera de él
    window.onclick = function (event) {
        if (event.target == document.getElementById("modalDetalles") || event.target == document.getElementById("modalReenviarFactura")) {
            cerrarModal();
        }
    }

    $('#tabla').DataTable({
    "order": [[0, "asc"]],
    "language": {
        "url": "//cdn.datatables.net/plug-ins/1.13.6/i18n/es-ES.json"
    },
    "dom": "<'row'<'col-sm-12 col-md-6'l><'col-sm-12 col-md-6'f>>" +
           "<'row'<'col-sm-12'tr>>" +
           "<'row'<'col-sm-12 col-md-5'i><'col-sm-12 col-md-7'p>>",
    "responsive": true,
    "autoWidth": false,
    "initComplete": function(settings, json) {
        // Añadir clase personalizada a los inputs
        $('.dataTables_filter input').addClass('search-input');
        $('.dataTables_length select').addClass('custom-select');
    }
});
</script>